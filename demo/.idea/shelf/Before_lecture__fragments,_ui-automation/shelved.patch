Index: app/src/androidTest/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ExampleInstrumentedTest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package ru.spbstu.icc.kspt.andrei.mydemoapplication;\n\nimport android.content.Context;\nimport android.support.test.InstrumentationRegistry;\nimport android.support.test.runner.AndroidJUnit4;\n\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\n\nimport static org.junit.Assert.*;\n\n/**\n * Instrumented test, which will execute on an Android device.\n *\n * @see <a href=\"http://d.android.com/tools/testing\">Testing documentation</a>\n */\n@RunWith(AndroidJUnit4.class)\npublic class ExampleInstrumentedTest {\n    @Test\n    public void useAppContext() {\n        // Context of the app under test.\n        Context appContext = InstrumentationRegistry.getTargetContext();\n\n        assertEquals(\"ru.spbstu.icc.kspt.andrei.mydemoapplication\", appContext.getPackageName());\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/androidTest/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ExampleInstrumentedTest.java	(date 1542215674000)
+++ app/src/androidTest/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ExampleInstrumentedTest.java	(date 1542223381310)
@@ -1,13 +1,25 @@
 package ru.spbstu.icc.kspt.andrei.mydemoapplication;
 
-import android.content.Context;
-import android.support.test.InstrumentationRegistry;
-import android.support.test.runner.AndroidJUnit4;
+import android.os.RemoteException;
 
+import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
-import static org.junit.Assert.*;
+import androidx.test.espresso.Espresso;
+import androidx.test.espresso.assertion.ViewAssertions;
+import androidx.test.espresso.matcher.ViewMatchers;
+import androidx.test.rule.ActivityTestRule;
+import androidx.test.runner.AndroidJUnit4;
+import androidx.test.uiautomator.UiDevice;
+
+import static androidx.test.espresso.Espresso.onData;
+import static androidx.test.espresso.Espresso.onView;
+import static androidx.test.espresso.action.ViewActions.click;
+import static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;
+import static androidx.test.espresso.matcher.ViewMatchers.isRoot;
+import static androidx.test.platform.app.InstrumentationRegistry.getInstrumentation;
+import static org.hamcrest.Matchers.is;
 
 /**
  * Instrumented test, which will execute on an Android device.
@@ -16,11 +28,23 @@
  */
 @RunWith(AndroidJUnit4.class)
 public class ExampleInstrumentedTest {
+    @Rule
+    public ActivityTestRule<ListActivity> mActivityRule
+            = new ActivityTestRule<>(ListActivity.class);
+
     @Test
-    public void useAppContext() {
-        // Context of the app under test.
-        Context appContext = InstrumentationRegistry.getTargetContext();
+    public void rotationTest() throws InterruptedException, RemoteException {
+        UiDevice device = UiDevice.getInstance(getInstrumentation());
+        device.setOrientationNatural();
+
+        onView(ViewMatchers.withId(R.id.list_fragment)).check(ViewAssertions.matches(isDisplayed()));
+        onData(is("Item1")).perform(click());
 
-        assertEquals("ru.spbstu.icc.kspt.andrei.mydemoapplication", appContext.getPackageName());
+        onView(ViewMatchers.withId(R.id.detailsText)).check(ViewAssertions.matches(ViewMatchers.withText("Item1")));
+
+        device.setOrientationLeft();
+
+        getInstrumentation().waitForIdleSync();
+        onView(ViewMatchers.withId(R.id.list_fragment)).check(ViewAssertions.matches(isDisplayed()));
     }
 }
Index: app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ACCharger.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ACCharger.java	(date 1542223867719)
+++ app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ACCharger.java	(date 1542223867719)
@@ -0,0 +1,23 @@
+package ru.spbstu.icc.kspt.andrei.mydemoapplication;
+
+import android.content.BroadcastReceiver;
+import android.content.Context;
+import android.content.Intent;
+import android.util.Log;
+
+public class ACCharger extends BroadcastReceiver {
+
+    public static final String POWER = "POWER";
+
+    @Override
+    public void onReceive(Context context, Intent intent) {
+        Log.i(POWER, intent.toString());
+        if (intent.getAction().equals(Intent.ACTION_POWER_CONNECTED)) {
+            Log.i(POWER, "CONNECTED");
+        } else if (intent.getAction().equals(Intent.ACTION_POWER_DISCONNECTED)){
+            Log.i(POWER, "DISCONNECTED");
+        } else {
+            Log.w(POWER, "UNKNOWN");
+        }
+    }
+}
Index: app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ArticleListFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ArticleListFragment.java	(date 1542216628364)
+++ app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ArticleListFragment.java	(date 1542216628364)
@@ -0,0 +1,51 @@
+package ru.spbstu.icc.kspt.andrei.mydemoapplication;
+
+import android.app.ListFragment;
+import android.content.Context;
+import android.os.Bundle;
+import android.support.annotation.Nullable;
+import android.view.View;
+import android.widget.ArrayAdapter;
+import android.widget.ListAdapter;
+import android.widget.ListView;
+
+public class ArticleListFragment extends ListFragment {
+    interface ArticleListener {
+        void onItemSelected(String article);
+    }
+
+    private String[] items = {"Item1", "Item2", "Item3"};
+    private ArticleListener articleListener;
+
+    @Override
+    public void onAttach(Context context) {
+        super.onAttach(context);
+        try {
+            articleListener = (ArticleListener) context;
+        } catch (ClassCastException e) {
+            throw new IllegalStateException("Holding activity must implement ArticleListener", e);
+        }
+    }
+
+    @Override
+    public void onDetach() {
+        super.onDetach();
+        articleListener = null;
+    }
+
+    @Override
+    public void onListItemClick(ListView l, View v, int position, long id) {
+        super.onListItemClick(l, v, position, id);
+        String article = items[position];
+        if (articleListener != null) {
+            articleListener.onItemSelected(article);
+        }
+    }
+
+    @Override
+    public void onActivityCreated(@Nullable Bundle savedInstanceState) {
+        super.onActivityCreated(savedInstanceState);
+        ListAdapter adapter = new ArrayAdapter<>(getActivity(), android.R.layout.simple_list_item_1, items);
+        setListAdapter(adapter);
+    }
+}
Index: app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/DetailsActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/DetailsActivity.java	(date 1542217673789)
+++ app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/DetailsActivity.java	(date 1542217673789)
@@ -0,0 +1,23 @@
+package ru.spbstu.icc.kspt.andrei.mydemoapplication;
+
+import android.app.Activity;
+import android.app.Fragment;
+import android.content.Intent;
+import android.os.Bundle;
+import android.support.annotation.Nullable;
+
+public class DetailsActivity extends Activity {
+    public static final String ARTICLE_EXTRA_KEY = "r.s.i.k.a.article";
+
+    @Override
+    protected void onCreate(@Nullable Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+        setContentView(R.layout.details_activity);
+
+        Intent detailsIntent = getIntent();
+        String article = detailsIntent.getStringExtra(ARTICLE_EXTRA_KEY);
+        DetailsFragment detailsFragment = (DetailsFragment) getFragmentManager().findFragmentById(R.id.details_fragment);
+        detailsFragment.updateText(article);
+    }
+
+}
Index: app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/DetailsFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/DetailsFragment.java	(date 1542218160353)
+++ app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/DetailsFragment.java	(date 1542218160353)
@@ -0,0 +1,36 @@
+package ru.spbstu.icc.kspt.andrei.mydemoapplication;
+
+import android.app.Fragment;
+import android.os.Bundle;
+import android.support.annotation.Nullable;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.TextView;
+
+public class DetailsFragment extends Fragment {
+
+    @Nullable
+    @Override
+    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, Bundle savedInstanceState) {
+        return inflater.inflate(R.layout.details_view, container, false);
+    }
+
+    @Override
+    public void onActivityCreated(@Nullable Bundle savedInstanceState) {
+        super.onActivityCreated(savedInstanceState);
+
+    }
+
+    @Override
+    public void onDestroyView() {
+        super.onDestroyView();
+    }
+
+    public void updateText(String text) {
+        TextView detailsText = getActivity().findViewById(R.id.detailsText);
+        if (detailsText != null) {
+            detailsText.setText(text);
+        }
+    }
+}
Index: app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ListActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ListActivity.java	(date 1542225578788)
+++ app/src/main/java/ru/spbstu/icc/kspt/andrei/mydemoapplication/ListActivity.java	(date 1542225578788)
@@ -0,0 +1,55 @@
+package ru.spbstu.icc.kspt.andrei.mydemoapplication;
+
+import android.app.Activity;
+import android.app.Fragment;
+import android.app.FragmentManager;
+import android.app.FragmentTransaction;
+import android.content.Intent;
+import android.content.IntentFilter;
+import android.content.res.Configuration;
+import android.os.Bundle;
+import android.support.annotation.Nullable;
+
+public class ListActivity extends Activity implements ArticleListFragment.ArticleListener {
+    private static final String INITIAL = "initial";
+    private boolean twoPanes = false;
+
+    @Override
+    protected void onCreate(@Nullable Bundle savedInstanceState) {
+
+        super.onCreate(savedInstanceState);
+
+        registerReceiver(new ACCharger(), new IntentFilter(Intent.ACTION_POWER_CONNECTED));
+
+        setContentView(R.layout.list_activity);
+        twoPanes = (getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDSCAPE);
+
+        FragmentManager mgr = getFragmentManager();
+        mgr.popBackStack(INITIAL, FragmentManager.POP_BACK_STACK_INCLUSIVE);
+        FragmentTransaction tx = mgr.beginTransaction();
+
+        if (twoPanes) {
+            tx.show(mgr.findFragmentById(R.id.list_fragment));
+            tx.show(mgr.findFragmentById(R.id.details_fragment));
+        } else {
+            tx.show(mgr.findFragmentById(R.id.list_fragment));
+            tx.hide(mgr.findFragmentById(R.id.details_fragment));
+        }
+        tx.commit();
+    }
+
+    @Override
+    public void onItemSelected(String article) {
+        DetailsFragment detailsFragment = (DetailsFragment) getFragmentManager().findFragmentById(R.id.details_fragment);
+        detailsFragment.updateText(article);
+        if (!twoPanes) {
+            FragmentManager mgr = getFragmentManager();
+            FragmentTransaction tx = mgr.beginTransaction();
+            tx.hide((mgr.findFragmentById(R.id.list_fragment)));
+            Fragment details = mgr.findFragmentById(R.id.details_fragment);
+            tx.show(details);
+            tx.addToBackStack(INITIAL);
+            tx.commit();
+        }
+    }
+}
Index: app/src/main/res/layout/details_activity.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/details_activity.xml	(date 1542217162585)
+++ app/src/main/res/layout/details_activity.xml	(date 1542217162585)
@@ -0,0 +1,11 @@
+<?xml version="1.0" encoding="utf-8"?>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment
+        android:id="@+id/details_fragment"
+        android:name="ru.spbstu.icc.kspt.andrei.mydemoapplication.DetailsFragment"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent" />
+</FrameLayout>
\ No newline at end of file
Index: app/src/main/res/layout/details_view.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/details_view.xml	(date 1542216692875)
+++ app/src/main/res/layout/details_view.xml	(date 1542216692875)
@@ -0,0 +1,24 @@
+<?xml version="1.0" encoding="utf-8"?>
+<android.support.constraint.ConstraintLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:app="http://schemas.android.com/apk/res-auto"
+    xmlns:tools="http://schemas.android.com/tools"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <TextView
+        android:id="@+id/detailsText"
+        android:layout_width="wrap_content"
+        android:layout_height="wrap_content"
+        android:layout_marginBottom="8dp"
+        android:layout_marginEnd="8dp"
+        android:layout_marginLeft="8dp"
+        android:layout_marginRight="8dp"
+        android:layout_marginStart="8dp"
+        android:layout_marginTop="8dp"
+        android:text="TextView"
+        app:layout_constraintBottom_toBottomOf="parent"
+        app:layout_constraintEnd_toEndOf="parent"
+        app:layout_constraintStart_toStartOf="parent"
+        app:layout_constraintTop_toTopOf="parent" />
+</android.support.constraint.ConstraintLayout>
\ No newline at end of file
Index: app/src/main/res/layout/layouts_test.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"horizontal\">\n\n    <Button\n        android:id=\"@+id/button4\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"left\"\n        android:text=\"Button\" />\n\n    <Button\n        android:id=\"@+id/button2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_horizontal\"\n        android:text=\"Button\" />\n\n    <Button\n        android:id=\"@+id/button3\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"right\"\n        android:text=\"Button\" />\n    <fragment\n        android:layout_width=\"\"\n        android:layout_height=\"\"\n</LinearLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/layouts_test.xml	(date 1542215674000)
+++ app/src/main/res/layout/layouts_test.xml	(date 1542217890444)
@@ -24,7 +24,4 @@
         android:layout_height="wrap_content"
         android:layout_gravity="right"
         android:text="Button" />
-    <fragment
-        android:layout_width=""
-        android:layout_height=""
 </LinearLayout>
\ No newline at end of file
Index: app/src/main/res/layout/list_activity.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/list_activity.xml	(date 1542222530299)
+++ app/src/main/res/layout/list_activity.xml	(date 1542222530299)
@@ -0,0 +1,18 @@
+<?xml version="1.0" encoding="utf-8"?>
+<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment
+        android:id="@+id/list_fragment"
+        android:name="ru.spbstu.icc.kspt.andrei.mydemoapplication.ArticleListFragment"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"/>
+
+    <fragment
+        android:id="@+id/details_fragment"
+        android:name="ru.spbstu.icc.kspt.andrei.mydemoapplication.DetailsFragment"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"/>
+
+</FrameLayout>
\ No newline at end of file
Index: app/src/main/res/layout-land/list_activity.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout-land/list_activity.xml	(date 1542218040850)
+++ app/src/main/res/layout-land/list_activity.xml	(date 1542218040850)
@@ -0,0 +1,20 @@
+<?xml version="1.0" encoding="utf-8"?>
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <fragment
+        android:id="@+id/list_fragment"
+        android:name="ru.spbstu.icc.kspt.andrei.mydemoapplication.ArticleListFragment"
+        android:layout_width="0dp"
+        android:layout_height="match_parent"
+        android:layout_weight="1"/>
+
+    <fragment
+        android:id="@+id/details_fragment"
+        android:name="ru.spbstu.icc.kspt.andrei.mydemoapplication.DetailsFragment"
+        android:layout_width="0dp"
+        android:layout_height="match_parent"
+        android:layout_weight="3"/>
+
+</LinearLayout>
\ No newline at end of file
Index: app/build.gradle
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>apply plugin: 'com.android.application'\n\nandroid {\n    compileSdkVersion 27\n    defaultConfig {\n        applicationId \"ru.spbstu.icc.kspt.andrei.mydemoapplication\"\n        minSdkVersion 15\n        targetSdkVersion 27\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        targetCompatibility 1.8\n        sourceCompatibility 1.8\n    }\n}\n\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n    implementation 'com.android.support:appcompat-v7:27.1.1'\n    implementation 'com.android.support.constraint:constraint-layout:1.1.3'\n    implementation 'com.android.support:design:27.1.1'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'com.android.support.test:runner:1.0.1'\n    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.1'\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/build.gradle	(date 1542215674000)
+++ app/build.gradle	(date 1542220677648)
@@ -4,11 +4,11 @@
     compileSdkVersion 27
     defaultConfig {
         applicationId "ru.spbstu.icc.kspt.andrei.mydemoapplication"
-        minSdkVersion 15
+        minSdkVersion 18
         targetSdkVersion 27
         versionCode 1
         versionName "1.0"
-        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
+        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
     }
     buildTypes {
         release {
@@ -23,11 +23,17 @@
 }
 
 dependencies {
-    implementation fileTree(dir: 'libs', include: ['*.jar'])
+    implementation fileTree(include: ['*.jar'], dir: 'libs')
     implementation 'com.android.support:appcompat-v7:27.1.1'
     implementation 'com.android.support.constraint:constraint-layout:1.1.3'
     implementation 'com.android.support:design:27.1.1'
     testImplementation 'junit:junit:4.12'
-    androidTestImplementation 'com.android.support.test:runner:1.0.1'
-    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.1'
+    androidTestImplementation 'androidx.test:runner:1.1.0'
+    androidTestImplementation 'androidx.test:rules:1.1.0'
+    // Optional -- Hamcrest library
+    androidTestImplementation 'org.hamcrest:hamcrest-library:1.3'
+    // Optional -- UI testing with Espresso
+    androidTestImplementation 'androidx.test.espresso:espresso-core:3.1.0'
+    // Optional -- UI testing with UI Automator
+    androidTestImplementation 'androidx.test.uiautomator:uiautomator:2.2.0'
 }
